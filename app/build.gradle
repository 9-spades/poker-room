/*
 * This file was generated by the Gradle 'init' task.
 *
 * This generated file contains a sample Java application project to get you started.
 * For more details on building Java & JVM projects, please refer to https://docs.gradle.org/9.0.0/userguide/building_java_projects.html in the Gradle documentation.
 */

plugins {
    // Apply the application plugin to add support for building a CLI application in Java.
    id 'application'
    // OpenAPI Generator plugin
    id 'org.openapi.generator' version '7.1.0'
    // Shadow JAR plugin
    id 'com.gradleup.shadow' version '9.0.0'
}

repositories {
    // Use Maven Central for resolving dependencies.
    mavenCentral()
}

dependencies {
    // Use JUnit Jupiter for testing.
    testImplementation libs.junit.jupiter
    testImplementation libs.mockito.core
    testImplementation libs.mockito.junit.jupiter
    testRuntimeOnly 'org.junit.platform:junit-platform-launcher'

    // This dependency is used by the application.
    implementation libs.guava
    // Swagger and validation for generated code
    implementation libs.swagger.annotations
    implementation libs.validation.api
    // JAX-RS API
    implementation libs.javax.jaxrs
    // Jersey JAX-RS implementation
    implementation libs.jersey.server
    implementation libs.jersey.container.servlet
    // Jackson JSON processing
    implementation libs.jackson.core
    implementation libs.jackson.databind
    implementation libs.jackson.annotations
    // DynamoDB for persistence
    implementation libs.aws.dynamodb
    implementation libs.aws.dynamodb.enhanced
    implementation libs.aws.annotations
    // AWS Lambda
    implementation libs.aws.lambda.java.core
    implementation libs.aws.lambda.java.events
}

// Apply a specific Java toolchain to ease working on different environments.
java {
    toolchain {
        languageVersion = JavaLanguageVersion.of(8)
    }
}

application {
    // Define the main class for the application.
    mainClass = 'spades.nine.poker.room.CardsApiImpl'
}

tasks.named('test') {
    // Use JUnit Platform for unit tests.
    useJUnitPlatform()
}

openApiGenerate {
    generatorName = "jaxrs-spec"
    inputSpec = "$rootDir/api-spec/poker-room.yaml"
    outputDir = "$buildDir/generated"
    apiPackage = "spades.nine.poker.room.api"
    modelPackage = "spades.nine.poker.room.model"
    configOptions = [
        interfaceOnly: "true",
        skipDefaultInterface: "true",
        useTags: "true",
        dateLibrary: "java8",
        java8: "true"
    ]
}

sourceSets {
    main {
        java {
            srcDir "${buildDir}/generated/src/gen/java"
        }
    }
}
compileJava.dependsOn tasks.openApiGenerate

shadowJar {
    archiveClassifier = ''
    mergeServiceFiles()
}
startScripts.dependsOn shadowJar
startShadowScripts.dependsOn jar

